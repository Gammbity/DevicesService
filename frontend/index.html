<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DernSupport - Kompyuter ta'mirlash xizmati</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="landing-page">
        <!-- Sarlavha -->
        <header class="header">
            <div class="container">
                <div class="logo">
                    <i class="fas fa-laptop-medical"></i>
                    <span>DernSupport</span>
                </div>
                <nav class="nav">
                    <ul class="nav-links">
                        <li><a href="#">Bosh sahifa</a></li>
                        <li><a href="#services">Xizmatlar</a></li>
                        <li><a href="#about">Biz haqimizda</a></li>
                        <li><a href="#contact">Aloqa</a></li>
                    </ul>
                    <a href="./login.html" class="btn primary-btn">Kirish</a>
                    <a href="http://13.49.213.104:8000/admin/" class="btn primary-btn">Manager</a>
                    <div class="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Qahramon bo‘limi -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>Mutaxassis <span>Kompyuter ta'mirlash</span> xizmati</h1>
                    <p>Texnik muammolaringizni tez va samarali hal qilamiz. Professional xizmat — arzon narxlarda.</p>
                    <a href="login.html" class="btn primary-btn">Boshlash</a>
                </div>
                <div class="hero-image">
                    <img src="./img/computer-repair-figurines.jpg" alt="Kompyuter ta'miri">
                </div>
            </div>
        </section>

        <!-- Xizmatlar -->
        <section id="services" class="services">
            <div class="container">
                <h2 class="section-title">Bizning xizmatlar</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <h3>Uskuna ta'miri</h3>
                        <p>Ekran, klaviatura, batareya va boshqa uskunalar ta'miri.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Virusni tozalash</h3>
                        <p>Virus, zararli dasturlarni tozalaymiz va xavfsizlikni ta'minlaymiz.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <h3>Tizimni yangilash</h3>
                        <p>Tezlikni oshirish uchun RAM, SSD va boshqa yangilanishlar.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nega biz? -->
        <section id="about" class="why-us">
            <div class="container">
                <h2 class="section-title">Nega aynan biz?</h2>
                <div class="features-grid">
                    <div class="feature">
                        <div class="feature-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3>Mutaxassis ustalar</h3>
                        <p>Yillik tajribaga ega sertifikatlangan mutaxassislar</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Tez xizmat</h3>
                        <p>Har qanday ta'mirlashda tezkor yechim</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <h3>Qulay narxlar</h3>
                        <p>Hech qanday yashirin to‘lovlarsiz raqobatbardosh narxlar</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3>Mijozlarni qo‘llab-quvvatlash</h3>
                        <p>Yordamga tayyor do‘stona jamoa</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chaqqonlik -->
        <section class="cta">
            <div class="container">
                <h2>Kompyuteringizni tuzatishga tayyormisiz?</h2>
                <p>Muammolar og‘irlashishini kutmang. Bizning ustalar sizga bugunoq yordam beradi!</p>
                <div id="submit-application-content" class="content-section content-submit">
                    <h2>Ariza yuborish</h2>
                    <form id="application-form" class="form-container" method="POST">
                        <div id="user-info-fields">
                            <div class="form-group">
                                <label for="name">Ismingiz</label>
                                <input type="text" id="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="text" id="email" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="device-name">Qurilma nomi</label>
                            <input type="text" id="device-name" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Tavsif</label>
                            <textarea id="description" rows="4" required></textarea>
                        </div>
                        <select id="location" name="location" required>
                            <option value="chernefka">Chernefka</option>
                            <option value="yunusobod">Yunusobod</option>
                            <option value="sebzor">Sebzor</option>
                        </select>
                        <select id="problem-type" name="problem_type" required>
                            <option value="software">Dasturiy ta'minot</option>
                            <option value="hardware">Kompyuter jihozi</option>
                        </select>
                        <div class="form-actions">
                            <button type="submit" class="btn primary-btn">Yuborish</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer" id="contact">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-logo">
                        <div class="logo">
                            <i class="fas fa-laptop-medical"></i>
                            <span>DernSupport</span>
                        </div>
                        <p>Texnik muammolaringiz uchun professional kompyuter ta'mirlash xizmati.</p>
                    </div>
                    <div class="footer-links">
                        <h3>Tezkor havolalar</h3>
                        <ul>
                            <li><a href="#">Bosh sahifa</a></li>
                            <li><a href="#services">Xizmatlar</a></li>
                            <li><a href="#about">Biz haqimizda</a></li>
                            <li><a href="#contact">Aloqa</a></li>
                        </ul>
                    </div>
                    <div class="footer-contact">
                        <h3>Biz bilan bog‘laning</h3>
                        <p><i class="fas fa-map-marker-alt"></i> 123 Ta'mirlash ko'chasi, Texno Shahar</p>
                        <p><i class="fas fa-phone"></i> +998 (90) 123-4567</p>
                        <p><i class="fas fa-envelope"></i> support@techfix.com</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2023 DernSupport. Barcha huquqlar himoyalangan.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("application-form");
            const userInfoFields = document.getElementById("user-info-fields");

            let user = {
                is_authenticated: false,
                email: null
            };

            async function fetchUserEmail() {
                try {
                    const res = await fetch("http://13.49.213.104:8000/api/v1/user/profile/", {
                        credentials: "include"
                    });

                    if (res.ok) {
                        const userData = await res.json();
                        user.is_authenticated = true;
                        user.email = userData.email;

                        if (userInfoFields) {
                            userInfoFields.style.display = "none";
                            document.getElementById("email").removeAttribute("required");
                            document.getElementById("name").removeAttribute("required");
                        }
                    }
                } catch (error) {
                    console.error("Error fetching user:", error);
                }
            }

            fetchUserEmail();

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const payload = {
                    email: document.getElementById("email").value || "email",
                    username: document.getElementById("name").value || "name",
                    name: document.getElementById("device-name").value,
                    description: document.getElementById("description").value,
                    location: document.getElementById("location").value,
                    problem_type: document.getElementById("problem-type").value
                };

                function getCookie(name) {
                    const cookies = document.cookie.split(";");
                    for (let cookie of cookies) {
                        const [key, value] = cookie.trim().split("=");
                        if (key === name) return decodeURIComponent(value);
                    }
                    return null;
                }

                const csrftoken = getCookie("csrftoken");

                try {
                    const response = await fetch("http://13.49.213.104:8000/api/v1/main/device/create/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": csrftoken
                        },
                        body: JSON.stringify(payload),
                        credentials: "include"
                    });

                    if (!response.ok) {
                        throw new Error("So‘rov yuborishda xatolik");
                    }

                    await response.json();
                    form.reset();
                    alert("Ariza muvaffaqiyatli yuborildi!");
                } catch (err) {
                    console.error(err);
                    alert("Xatolik yuz berdi!");
                }
            });
        });
    </script>

</body>

</html>